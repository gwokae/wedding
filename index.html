<!DOCTYPE html>
<html lang="en">
<head>
    <title>Draggableddd Image Boxes Grid</title>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le styles -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="assets/js/google-code-prettify/prettify.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <noscript>
        <style>
            .ib-main a {
                cursor: pointer;
            }

            .ib-main-wrapper {
                position: absolute;
                top: 0px;
                bottom: 24px;
                overflow: scroll;
            }
        </style>
    </noscript>
    <link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'/>
    <script id="previewTmpl" type="text/x-jquery-tmpl">
        <div id="ib-img-preview" class="ib-preview">
            <img src="${src}" alt="" class="ib-preview-img"/>
            <span class="ib-preview-descr" style="display:none;">${description}</span>

            <div class="ib-nav" style="display:none;">
                <span class="ib-nav-prev">Previous</span>
                <span class="ib-nav-next">Next</span>
            </div>
            <span class="ib-close" style="display:none;">Close Preview</span>

            <div class="ib-loading-large" style="display:none;">Loading...</div>
        </div>
    </script>
    <script id="contentTmpl" type="text/x-jquery-tmpl">
        <div id="ib-content-preview" class="ib-content-preview">
            <div class="ib-teaser" style="display:none;">{{html teaser}}</div>
            <div class="ib-content-full" style="display:none;">{{html content}}</div>
            <span class="ib-close" style="display:none;">Close Preview</span>
        </div>
    </script>
</head>
<body data-spy="scroll" data-target=".bs-docs-sidebar">
<!-- Navbar
================================================== -->
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="brand" href="./index.html">MINI & TERRY'S WEDDING</a>

            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li class="active">
                        <a href="./index.html">Home</a>
                    </li>
                    <li class="">
                        <a href="./getting-started.html">Get started</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="ib-container">
    <div id="header" class="header">
        <a href=""><span></span></a>
                <span class="right_ab">
                </span>
    </div>
    <div id="ib-top" class="ib-top">
        <h1><span>2012/12/09</span></h1>
    </div>
    <div id="ib-main-wrapper" class="ib-main-wrapper">
        <div class="ib-main">
            <a href="#" class="ib-content">
                <div class="ib-teaser">
                    <h2>Welcome <span>Hello, my friends</span></h2>
                </div>
                <div class="ib-content-full">
                    <p></p>
                </div>
            </a>
            <a href="#"><img src="images/thumbs/05.jpg" data-largesrc="images/large/05.jpg" alt="image05"/><span>Crabbed Age and Youth</span></a>
            <a href="#"><img src="images/thumbs/23.jpg" data-largesrc="images/large/23.jpg" alt="image02"/><span>Crabbed Age and Youth</span></a>
            <a href="#" class="ib-content">
                <div class="ib-teaser">
                    <h2>When<span>2012/12/09</span></h2>
                </div>
                <div class="ib-content-full">
                    <p>12月9日中午12點</p>
                </div>
            </a>
            <a href="#"><img src="images/thumbs/13.jpg" data-largesrc="images/large/13.jpg" alt="image01"/><span>Crabbed Age and Youth</span></a>
            <a href="#"><img src="images/thumbs/25.jpg" data-largesrc="images/large/25.jpg" alt="image01"/><span>Crabbed Age and Youth</span></a>
            <a href="#" class="ib-content">
                <div class="ib-teaser">
                    <h2>Where<span>桃園市福祥宴餐廳</span></h2>
                </div>
                <div class="ib-content-full">
                    <p>桃園市中正路1047號</p>
                </div>
            </a>
            <a href="#"><img src="images/thumbs/28.jpg" data-largesrc="images/large/28.jpg" alt="image01"/><span>Crabbed Age and Youth</span></a>
            <a href="#"><img src="images/thumbs/08.jpg" data-largesrc="images/large/08.jpg" alt="image02"/><span>Crabbed Age and Youth</span></a>
            <a href="#"><img src="images/thumbs/02.jpg" data-largesrc="images/large/02.jpg" alt="image02"/><span>Crabbed Age and Youth</span></a>
            <a href="#"><img src="images/thumbs/16.jpg" data-largesrc="images/large/16.jpg" alt="image01"/><span>Crabbed Age and Youth</span></a>
            <a href="#"><img src="images/thumbs/10.jpg" data-largesrc="images/large/10.jpg" alt="image01"/><span>Crabbed Age and Youth</span></a>
            <a href="#"><img src="images/thumbs/19.jpg" data-largesrc="images/large/19.jpg" alt="image01"/><span>Crabbed Age and Youth</span></a>
            <a href="#"><img src="images/thumbs/22.jpg" data-largesrc="images/large/22.jpg" alt="image01"/><span>Crabbed Age and Youth</span></a>
            <a href="#"><img src="images/thumbs/01.jpg" data-largesrc="images/large/01.jpg" alt="image01"/><span>Crabbed Age and Youth</span></a>
            <a href="#"><img src="images/thumbs/18.jpg" data-largesrc="images/large/18.jpg" alt="image03"/><span>Youth is full of pleasance</span></a>
            <a href="#"><img src="images/thumbs/27.jpg" data-largesrc="images/large/27.jpg" alt="image03"/><span>Youth is full of pleasance</span></a>
            <a href="#"><img src="images/thumbs/29.jpg" data-largesrc="images/large/29.jpg" alt="image02"/><span>Crabbed Age and Youth</span></a>

            <div class="clr"></div>
        </div>
        <!-- ib-main -->
    </div>
    <!-- ib-main-wrapper -->
</div>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.tmpl.min.js"></script>
<script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="js/jquery.mousewheel.min.js"></script>
<script type="text/javascript">
$(function () {

    var $ibWrapper = $('#ib-main-wrapper'),

            Template = (function () {

                // current index of the opened item
                        current = -1,
                // true if the item is being opened / closed
                        isAnimating = false,
                // items on the grid
                        $ibItems = $ibWrapper.find('div.ib-main > a'),
                // image items on the grid
                        $ibImgItems = $ibItems.not('.ib-content'),
                // total image items on the grid
                        imgItemsCount = $ibImgItems.length,
                        init = function () {

                            // add a class ib-image to the image items
                            $ibImgItems.addClass('ib-image');
                            // load some events
                            initEvents();

                        },
                        initEvents = function () {

                            // open the item only if not dragging the container
                            $ibItems.bind('click.ibTemplate', function (event) {

                                    openItem($(this));

                                return false;

                            });


                        },
                        openItem = function ($item) {

                            if (isAnimating) return false;

                            // if content item
                            if ($item.hasClass('ib-content')) {

                                isAnimating = true;
                                current = $item.index('.ib-content');
                                loadContentItem($item, function () {
                                    isAnimating = false;
                                });

                            }
                            // if image item
                            else {

                                isAnimating = true;
                                current = $item.index('.ib-image');
                                loadImgPreview($item, function () {
                                    isAnimating = false;
                                });

                            }

                        },
                // opens one image item (fullscreen)
                        loadImgPreview = function ($item, callback) {

                            var largeSrc = $item.children('img').data('largesrc'),
                                    description = $item.children('span').text(),
                                    largeImageData = {
                                        src:largeSrc,
                                        description:description
                                    };

                            // preload large image
                            $item.addClass('ib-loading');

                            preloadImage(largeSrc, function () {

                                $item.removeClass('ib-loading');

                                var hasImgPreview = ( $('#ib-img-preview').length > 0 );

                                if (!hasImgPreview)
                                    $('#previewTmpl').tmpl(largeImageData).insertAfter($ibWrapper);
                                else
                                    $('#ib-img-preview').children('img.ib-preview-img')
                                            .attr('src', largeSrc)
                                            .end()
                                            .find('span.ib-preview-descr')
                                            .text(description);

                                //get dimentions for the image, based on the windows size
                                var dim = getImageDim(largeSrc);

                                $item.removeClass('ib-img-loading');

                                //set the returned values and show/animate preview
                                $('#ib-img-preview').css({
                                    width:$item.width(),
                                    height:$item.height(),
                                    left:$item.offset().left,
                                    top:$item.offset().top
                                }).children('img.ib-preview-img').hide().css({
                                            width:dim.width,
                                            height:dim.height,
                                            left:dim.left,
                                            top:dim.top
                                        }).fadeIn(400).end().show().animate({
                                            width:$(window).width(),
                                            left:0
                                        }, 500, 'easeOutExpo', function () {

                                            $(this).animate({
                                                height:$(window).height(),
                                                top:0
                                            }, 400, function () {

                                                var $this = $(this);
                                                $this.find('span.ib-preview-descr, span.ib-close').show()
                                                if (imgItemsCount > 1)
                                                    $this.find('div.ib-nav').show();

                                                if (callback) callback.call();

                                            });

                                        });

                                if (!hasImgPreview)
                                    initImgPreviewEvents();

                            });

                        },
                // opens one content item (fullscreen)
                        loadContentItem = function ($item, callback) {

                            var hasContentPreview = ( $('#ib-content-preview').length > 0 ),
                                    teaser = $item.children('div.ib-teaser').html(),
                                    content = $item.children('div.ib-content-full').html(),
                                    contentData = {
                                        teaser:teaser,
                                        content:content
                                    };

                            if (!hasContentPreview)
                                $('#contentTmpl').tmpl(contentData).insertAfter($ibWrapper);

                            //set the returned values and show/animate preview
                            $('#ib-content-preview').css({
                                width:$item.width(),
                                height:$item.height(),
                                left:$item.offset().left,
                                top:$item.offset().top
                            }).show().animate({
                                        width:$(window).width(),
                                        left:0
                                    }, 500, 'easeOutExpo', function () {

                                        $(this).animate({
                                            height:$(window).height(),
                                            top:0
                                        }, 400, function () {

                                            var $this = $(this),
                                                    $teaser = $this.find('div.ib-teaser'),
                                                    $content = $this.find('div.ib-content-full'),
                                                    $close = $this.find('span.ib-close');

                                            if (hasContentPreview) {
                                                $teaser.html(teaser)
                                                $content.html(content)
                                            }

                                            $teaser.show();
                                            $content.show();
                                            $close.show();

                                            if (callback) callback.call();

                                        });

                                    });

                            if (!hasContentPreview)
                                initContentPreviewEvents();

                        },
                // preloads an image
                        preloadImage = function (src, callback) {

                            $('<img/>').load(function () {

                                if (callback) callback.call();

                            }).attr('src', src);

                        },
                // load the events for the image preview : navigation ,close button, and window resize
                        initImgPreviewEvents = function () {

                            var $preview = $('#ib-img-preview');

                            $preview.bind('click', function (event) {
                                navigate('next');
                            });
                            $preview.mousewheel(function (event, delta, deltaX, deltaY) {
                                navigate(delta === 1 ? 'prev' : 'next');
                            });

                            $preview.find('span.ib-nav-prev').bind('click.ibTemplate',function (event) {

                                navigate('prev');

                            }).end().find('span.ib-nav-next').bind('click.ibTemplate',function (event) {

                                        navigate('next');

                                    }).end().find('span.ib-close').bind('click.ibTemplate', function (event) {

                                        closeImgPreview();

                                    });

                            //resizing the window resizes the preview image
                            $(window).bind('resize.ibTemplate', function (event) {

                                var $largeImg = $preview.children('img.ib-preview-img'),
                                        dim = getImageDim($largeImg.attr('src'));

                                $largeImg.css({
                                    width:dim.width,
                                    height:dim.height,
                                    left:dim.left,
                                    top:dim.top
                                })

                            });

                        },
                // load the events for the content preview : close button
                        initContentPreviewEvents = function () {

                            $('#ib-content-preview').find('span.ib-close').bind('click.ibTemplate', function (event) {

                                closeContentPreview();

                            });

                        },
                // navigate the image items in fullscreen mode
                        navigate = function (dir) {

                            if (isAnimating) return false;

                            isAnimating = true;

                            var $preview = $('#ib-img-preview'),
                                    $loading = $preview.find('div.ib-loading-large');

                            $loading.show();

                            if (dir === 'next') {

                                ( current === imgItemsCount - 1 ) ? current = 0 : ++current;

                            }
                            else if (dir === 'prev') {

                                ( current === 0 ) ? current = imgItemsCount - 1 : --current;

                            }

                            var $item = $ibImgItems.eq(current),
                                    largeSrc = $item.children('img').data('largesrc'),
                                    description = $item.children('span').text();

                            preloadImage(largeSrc, function () {

                                $loading.hide();

                                //get dimentions for the image, based on the windows size
                                var dim = getImageDim(largeSrc);

                                $preview.children('img.ib-preview-img')
                                        .attr('src', largeSrc)
                                        .css({
                                            width:dim.width,
                                            height:dim.height,
                                            left:dim.left,
                                            top:dim.top
                                        })
                                        .end()
                                        .find('span.ib-preview-descr')
                                        .text(description);

                                $ibWrapper.scrollTop($item.offset().top)
                                        .scrollLeft($item.offset().left);

                                isAnimating = false;

                            });

                        },
                // closes the fullscreen image item
                        closeImgPreview = function () {

                            if (isAnimating) return false;

                            isAnimating = true;

                            var $item = $ibImgItems.eq(current);

                            $('#ib-img-preview').find('span.ib-preview-descr, div.ib-nav, span.ib-close')
                                    .hide()
                                    .end()
                                    .animate({
                                        height:$item.height(),
                                        top:$item.offset().top
                                    }, 500, 'easeOutExpo', function () {

                                        $(this).animate({
                                            width:$item.width(),
                                            left:$item.offset().left
                                        }, 400, function () {

                                            $(this).fadeOut(function () {
                                                isAnimating = false;
                                            });

                                        });

                                    });

                        },
                // closes the fullscreen content item
                        closeContentPreview = function () {

                            if (isAnimating) return false;

                            isAnimating = true;

                            var $item = $ibItems.not('.ib-image').eq(current);

                            $('#ib-content-preview').find('div.ib-teaser, div.ib-content-full, span.ib-close')
                                    .hide()
                                    .end()
                                    .animate({
                                        height:$item.height(),
                                        top:$item.offset().top
                                    }, 500, 'easeOutExpo', function () {

                                        $(this).animate({
                                            width:$item.width(),
                                            left:$item.offset().left
                                        }, 400, function () {

                                            $(this).fadeOut(function () {
                                                isAnimating = false;
                                            });

                                        });

                                    });

                        },
                // get the size of one image to make it full size and centered
                        getImageDim = function (src) {

                            var img = new Image();
                            img.src = src;

                            var w_w = $(window).width(),
                                    w_h = $(window).height(),
                                    r_w = w_h / w_w,
                                    i_w = img.width,
                                    i_h = img.height,
                                    r_i = i_h / i_w,
                                    new_w, new_h,
                                    new_left, new_top;

                            if (r_w > r_i) {

                                new_h = w_h;
                                new_w = w_h / r_i;

                            }
                            else {

                                new_h = w_w * r_i;
                                new_w = w_w;

                            }

                            return {
                                width:new_w,
                                height:new_h,
                                left:(w_w - new_w) / 2,
                                top:(w_h - new_h) / 2
                            };

                        };

                return { init:init };

            })();

    Template.init();

});
</script>
</body>
</html>	